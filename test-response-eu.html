<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
<style> .registration-form { max-width: 500px; margin: 0 auto; padding: 30px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 14px; position: relative; } .form-group { margin-bottom: 15px; } .form-group.has-error input, .form-group.has-error select, .phone-group.has-error input, .phone-group.has-error select { border-color: #dc3545; box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.15); } .form-group label { display: block; margin-bottom: 8px; color: #323232; font-weight: 600; font-size: 0.80rem; } input[type="text"], input[type="email"], input[type="password"], input[type="tel"], input[type="date"], select { width: 100%; padding: 8px 15px; border: 1px solid #ced4da; border-radius: 5px; background: rgba(255,255,255,0.9); font-size: 15px; transition: all 0.3s ease; box-sizing: border-box; } input:focus { outline: none; border-color: white; background: white; box-shadow: 0 0 0 3px rgba(0,0,0,0.2); } .checkbox-group input[type="checkbox"] { width: auto; margin-top: 4px; } .checkbox-group label { margin-bottom: 0; flex: 1;display: inline; } .social-buttons { display: flex; gap: 10px; margin-top: 20px; } .btn-social { flex: 1; padding: 9px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; border-radius: 5px; background-color: #fff; border: 1px solid #dadce0; color: #3c4043; display: flex; align-items: center; justify-content: center; gap: 8px; } .btn-social .social-logo { display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0; } .btn-social .social-logo svg { width: 20px; height: 20px; display: block; } .btn-social span { display: inline-block; } .btn-social:hover { -webkit-box-shadow: none; box-shadow: none; border-color: #d2e3fc; outline: none; background: rgba(66, 133, 244, .04); } .btn-submit { width: 100%; padding: 9px 15px; font-size: 1.1rem; font-weight: 700; cursor: pointer; color: #fff; background-color: #075c8f; border: 1px solid #075c8f; border-radius: 4px; transition: .3s all ease; } .btn-submit:hover:not(:disabled) { transform: none; box-shadow: navajowhite; color: #075c8f; background-color: #fff; } .btn-submit:disabled { opacity: 0.6; cursor: not-allowed; pointer-events: none; } .form-disclaimers { margin-top: 20px; padding: 15px; background-color: rgba(0,0,0,0.1); border-radius: 8px; color: black; font-size: 0.85rem; line-height: 1.4; } .form-disclaimers p { margin: 0 0 8px 0; } .form-disclaimers p:last-child { margin-bottom: 0; } .phone-group .phone-inputs { display: flex; gap: 12px; align-items: stretch; } .phone-group .country-code-select { flex: 0 0 100px; } .phone-group .phone-number-input { flex: 1; } .phone-group select { border-radius: 5px 0 0 5px; } .phone-group .phone-number-input input { border-radius: 0 5px 5px 0; } @media (max-width: 767px) { .registration-form { padding: 20px 15px; } .phone-group .phone-inputs { gap: 5px; } } .brand-highlight { margin-top: 24px; padding: 0; border-radius: 0; } .brand-assets { display: flex; flex-direction: column; flex-wrap: wrap; gap: 30px; align-items: center; justify-content: space-between; } .brand-badge { flex: 1; min-width: 120px; text-align: center; color: #323232; font-weight: 600; width: 100%; } .brand-badge img { max-height: 48px; width: auto; filter: drop-shadow(0 0 8px rgba(0,0,0,0.2)); max-width: 100%; } .brand-badge.brand-logo { padding: 25px 0; margin-top: 5px; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd; text-align: center; width: 100%; } .brand-badge.brand-logo img{ max-height: unset; width: 248px; filter: none; max-width: 100%; } .brand-copy { margin-top: 18px; text-align: center; color: #323232; font-size: 0.9rem; line-height: 1.5; } .brand-copy p { margin: 0 0 8px 0; } .brand-copy p:last-child { margin-bottom: 0; } .brand-disclaimers { font-size: 14px; color: #666; line-height: 1.5; text-align: left; } .brand-disclaimers p { margin: 0 0 6px 0; } .brand-disclaimers p:last-child { margin-bottom: 0; } .brand-trustpilot .trustpilot-rating { display: flex; flex-direction: column; align-items: center; color: #323232; font-size: 0.9rem; gap: 4px; } .brand-trustpilot .trustpilot-stars { color: #00b67a; font-size: 1.2rem; letter-spacing: 3px; } .risk-warning { margin-top: 30px; padding-top: 20px; color: #666; font-size: 14px; line-height: 1.6; font-weight: 500; display: flex; flex-direction: column; gap: 10px; } .risk-warning::before { content: ''; position: absolute; transform: translateY(-20px); left: 0; width: 100%; height: 1px; background-color: #a7a9ab; } .risk-warning p { margin: 0; } .login-link-wrapper { margin-top: 10px; text-align: right; } .login-link { color: #0F5B8E; text-decoration: none; font-weight: 600;font-size: 14px; } .login-link:hover { text-decoration: underline; } .hidden { display: none !important; } body.modal-open { overflow: hidden; } .error-message { color: #323232; font-size: 13px; margin-top: 5px; display: block; font-weight: 500; } .field-note { margin-top: 4px; font-size: 13px; color: #323232; } .form-disclaimers { margin-top: 15px; font-size: 0.8rem; color: rgba(255,255,255,0.9); line-height: 1.4; } .form-disclaimers p { margin: 0 0 6px 0; } .form-disclaimers p:last-child { margin-bottom: 0; } .restriction-modal { font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 9999; } .restriction-modal .modal-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.65); } .restriction-modal .modal-dialog { position: relative; background: #ffffff; color: #1f2937; border-radius: 12px; padding: 32px; max-width: 480px; width: calc(100% - 32px); box-shadow: 0 20px 60px rgba(0,0,0,0.35); z-index: 1; } .restriction-modal .modal-heading { font-size: 1.25rem; font-weight: 700; margin-bottom: 12px; color: #075c8f; text-align: center; } .restriction-modal .modal-message { font-size: 0.95rem; line-height: 1.5; color: #58585b; } .restriction-modal .modal-message p { margin-bottom: 12px; } .restriction-modal .modal-message p:last-child { margin-bottom: 0; } .restriction-modal .modal-actions { margin-top: 24px; display: flex; flex-direction: column; gap: 8px; } .restriction-modal .btn-modal-back { width: 100%; padding: 12px; font-weight: 600; cursor: pointer; border-radius: 5px; background: #075c8f; color: #fff; border: 1px solid #075c8f; } .restriction-modal .btn-modal-back:hover { opacity: 0.9; } .restriction-modal .modal-cancel { background: transparent; border: none; font-weight: 600; text-decoration: none; padding: 8px 0; cursor: pointer; width: 100%; color: #075c8f; } .restriction-modal .modal-cancel:hover { text-decoration: underline; } .restriction-modal .btn.btn-wide { width: 100%; } a {color: #0F5B8E;} .title-wline { margin-top: 15px; margin-bottom: 15px; color: #999; display: table; white-space: nowrap; padding-left: 1.5%; padding-right: 1.5%; } .title-wline::before, .title-wline::after { border-top: 1px solid #333333; content: ''; display: table-cell; position: relative; top: 0.5em; width: 50%; } .title-wline::before, .title-wline::after { border-top: 1px solid #bbb; top: 0.8em; } .title-wline::before { right: 1.5%; } .title-wline::after { left: 1.5%; } .text-center.text-branded.reg-first { margin: 0 0 5px; } .text-center.text-branded.reg-first a { text-decoration: none; } .text-center.text-branded.reg-first a:hover { text-decoration: underline; } .h2 { font-size: 24px; font-weight: 600; margin: 0 0 20px!important; } .text-center { text-align: center !important; } .text-branded { color: #075C8F; } .text-light { color: #999999 !important; } .text-dark { color: #343a40 !important; } </style> <form id="registrationForm" class="registration-form"> <input type="hidden" name="isDemo" value="false" /> <p class="h2 text-center text-branded reg-first">LIVE TRADING <span class="text-light">|</span> <span class="text-dark">Sign Up</span></p> <div class="form-group" data-field-name="firstName"> <input type="text" id="firstName" name="firstName" placeholder="Enter your first name" aria-label="First Name" required pattern="^[A-Za-z ]+$" /> <span class="error-message" data-field="firstName"></span> </div> <div class="form-group" data-field-name="lastName"> <input type="text" id="lastName" name="lastName" placeholder="Enter your last name" aria-label="Last Name" required pattern="^[A-Za-z ]+$" /> <span class="error-message" data-field="lastName"></span> </div> <div class="form-group" data-field-name="email"> <input type="email" id="email" name="email" placeholder="Enter your email" aria-label="Email Address" required pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$" /> <span class="error-message" data-field="email"></span> </div> <div class="form-group" data-field-name="password"> <input type="password" id="password" name="password" placeholder="Create a password" aria-label="Password" required minlength="6" /> <span class="error-message" data-field="password"></span> </div> <div class="form-group" data-field-name="country"> <select id="country" name="country" required aria-label="Country of Residence" > <option value="" selected>Select Country</option> <option value="13">Austria</option><option value="20">Belgium</option><option value="32">Bulgaria</option><option value="54">Croatia</option><option value="55">Cyprus</option><option value="56">Czech Republic</option><option value="57">Denmark</option><option value="69">Estonia</option><option value="74">Finland</option><option value="75">France</option><option value="76">French Guiana</option><option value="82">Germany</option><option value="86">Greece</option><option value="89">Guadeloupe</option><option value="98">Hungary</option><option value="99">Iceland</option><option value="102">Ireland</option><option value="104">Italy</option><option value="117">Latvia</option><option value="121">Liechtenstein</option><option value="122">Lithuania</option><option value="123">Luxembourg</option><option value="131">Malta</option><option value="133">Martinique</option><option value="149">Netherlands</option><option value="160">Norway</option><option value="170">Poland</option><option value="171">Portugal</option><option value="174">Reunion</option><option value="175">Romania</option><option value="265">Saint Martin</option><option value="191">Slovakia</option><option value="192">Slovenia</option><option value="198">Spain</option><option value="205">Sweden</option> </select> <span class="error-message" data-field="country"></span> <p class="field-note">This is the country where I reside and pay my taxes.</p> </div> <div class="form-group phone-group" data-field-name="countryCode"> <div class="phone-inputs"> <div class="country-code-select"> <select id="countryCode" name="countryCode" required aria-label="Country Code" > <option value="" selected>Select Country Code</option> <option value="1">+1</option><option value="20">+20</option><option value="212">+212</option><option value="213">+213</option><option value="216">+216</option><option value="218">+218</option><option value="220">+220</option><option value="221">+221</option><option value="222">+222</option><option value="223">+223</option><option value="224">+224</option><option value="225">+225</option><option value="226">+226</option><option value="227">+227</option><option value="228">+228</option><option value="229">+229</option><option value="230">+230</option><option value="231">+231</option><option value="232">+232</option><option value="233">+233</option><option value="234">+234</option><option value="235">+235</option><option value="236">+236</option><option value="237">+237</option><option value="238">+238</option><option value="239">+239</option><option value="240">+240</option><option value="241">+241</option><option value="242">+242</option><option value="243">+243</option><option value="244">+244</option><option value="245">+245</option><option value="246">+246</option><option value="248">+248</option><option value="249">+249</option><option value="250">+250</option><option value="251">+251</option><option value="252">+252</option><option value="253">+253</option><option value="254">+254</option><option value="255">+255</option><option value="256">+256</option><option value="257">+257</option><option value="258">+258</option><option value="260">+260</option><option value="261">+261</option><option value="262">+262</option><option value="263">+263</option><option value="264">+264</option><option value="265">+265</option><option value="266">+266</option><option value="267">+267</option><option value="268">+268</option><option value="269">+269</option><option value="27">+27</option><option value="290">+290</option><option value="291">+291</option><option value="297">+297</option><option value="298">+298</option><option value="299">+299</option><option value="30">+30</option><option value="31">+31</option><option value="32">+32</option><option value="33">+33</option><option value="34">+34</option><option value="350">+350</option><option value="351">+351</option><option value="352">+352</option><option value="353">+353</option><option value="354">+354</option><option value="355">+355</option><option value="356">+356</option><option value="357">+357</option><option value="358">+358</option><option value="359">+359</option><option value="36">+36</option><option value="370">+370</option><option value="371">+371</option><option value="372">+372</option><option value="373">+373</option><option value="374">+374</option><option value="375">+375</option><option value="376">+376</option><option value="377">+377</option><option value="378">+378</option><option value="380">+380</option><option value="381">+381</option><option value="382">+382</option><option value="385">+385</option><option value="386">+386</option><option value="387">+387</option><option value="389">+389</option><option value="39">+39</option><option value="40">+40</option><option value="41">+41</option><option value="420">+420</option><option value="421">+421</option><option value="423">+423</option><option value="43">+43</option><option value="44">+44</option><option value="45">+45</option><option value="46">+46</option><option value="47">+47</option><option value="48">+48</option><option value="49">+49</option><option value="500">+500</option><option value="501">+501</option><option value="502">+502</option><option value="503">+503</option><option value="504">+504</option><option value="505">+505</option><option value="506">+506</option><option value="507">+507</option><option value="508">+508</option><option value="509">+509</option><option value="51">+51</option><option value="52">+52</option><option value="53">+53</option><option value="54">+54</option><option value="55">+55</option><option value="56">+56</option><option value="57">+57</option><option value="58">+58</option><option value="590">+590</option><option value="591">+591</option><option value="592">+592</option><option value="593">+593</option><option value="594">+594</option><option value="595">+595</option><option value="596">+596</option><option value="597">+597</option><option value="598">+598</option><option value="599">+599</option><option value="60">+60</option><option value="61">+61</option><option value="62">+62</option><option value="63">+63</option><option value="64">+64</option><option value="65">+65</option><option value="66">+66</option><option value="670">+670</option><option value="672">+672</option><option value="673">+673</option><option value="674">+674</option><option value="675">+675</option><option value="676">+676</option><option value="677">+677</option><option value="678">+678</option><option value="679">+679</option><option value="680">+680</option><option value="681">+681</option><option value="682">+682</option><option value="683">+683</option><option value="685">+685</option><option value="686">+686</option><option value="687">+687</option><option value="688">+688</option><option value="689">+689</option><option value="690">+690</option><option value="691">+691</option><option value="692">+692</option><option value="7">+7</option><option value="81">+81</option><option value="82">+82</option><option value="84">+84</option><option value="852">+852</option><option value="853">+853</option><option value="855">+855</option><option value="856">+856</option><option value="86">+86</option><option value="880">+880</option><option value="886">+886</option><option value="90">+90</option><option value="91">+91</option><option value="92">+92</option><option value="93">+93</option><option value="94">+94</option><option value="95">+95</option><option value="960">+960</option><option value="961">+961</option><option value="962">+962</option><option value="963">+963</option><option value="964">+964</option><option value="965">+965</option><option value="966">+966</option><option value="967">+967</option><option value="968">+968</option><option value="970">+970</option><option value="971">+971</option><option value="973">+973</option><option value="974">+974</option><option value="975">+975</option><option value="976">+976</option><option value="977">+977</option><option value="98">+98</option><option value="992">+992</option><option value="993">+993</option><option value="994">+994</option><option value="995">+995</option><option value="996">+996</option><option value="998">+998</option> </select> <span class="error-message" data-field="countryCode"></span> </div> <div class="phone-number-input"> <input type="tel" id="phone" name="phone" placeholder="Enter your phone number" aria-label="Phone Number" required /> <span class="error-message" data-field="phone"></span> </div> </div> </div> <div class="form-group checkbox-group" data-field-name="acceptTerms"> <input type="checkbox" id="acceptTerms" name="acceptTerms" required /> <label for="acceptTerms">I declare that I have read and understood the <a title="Privacy Policy" data-legal-document="privacy-policy" target="_blank" href="https://static.easy-markets.com/assets/assets/view/20251030-privacy-policy-eu-EN.pdf">Privacy Policy</a> I confirm that I am 18 years or older, and consent to Easy Forex Trading Ltd processing my personal data to communicate with me for market news and browser notifications, with the option to unsubscribe from this list at any time, as specified in the <a title="Privacy Policy" data-legal-document="privacy-policy" target="_blank" href="https://static.easy-markets.com/assets/assets/view/20251030-privacy-policy-eu-EN.pdf">Privacy Policy</a>.</label> <span class="error-message" data-field="acceptTerms"></span> </div> <button type="submit" class="btn-submit">Sign Up</button> <div class="login-link-wrapper"> <a href="#" data-dismiss="modal" data-toggle="modal" data-target="#loginModal" data-gtm_trigger="Signup Details Live Popup (link) : Login" class="login-link" > Already have an account? </a> </div> <p class="title-wline">or connect with</p> <div class="social-buttons"> <button type="button" class="btn-social btn-google"> <span class="social-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20"><path fill="#FBBB00" d="M113.47,309.408L95.648,375.94l-65.139,1.378C11.042,341.211,0,299.9,0,256c0-42.451,10.324-82.483,28.624-117.732h0.014l57.992,10.632l25.404,57.644c-5.317,15.501-8.215,32.141-8.215,49.456C103.821,274.792,107.225,292.797,113.47,309.408z"></path><path fill="#518EF8" d="M507.527,208.176C510.467,223.662,512,239.655,512,256c0,18.328-1.927,36.206-5.598,53.451c-12.462,58.683-45.025,109.925-90.134,146.187l-0.014-0.014l-73.044-3.727l-10.338-64.535c29.932-17.554,53.324-45.025,65.646-77.911h-136.89V208.176h138.887L507.527,208.176L507.527,208.176z"></path><path fill="#28B446" d="M416.253,455.624l0.014,0.014C372.396,490.901,316.666,512,256,512c-97.491,0-182.252-54.491-225.491-134.681l82.961-67.91c21.619,57.698,77.278,98.771,142.53,98.771c28.047,0,54.323-7.582,76.87-20.818L416.253,455.624z"></path><path fill="#F14336" d="M419.404,58.936l-82.933,67.896c-23.335-14.586-50.919-23.012-80.471-23.012c-66.729,0-123.429,42.957-143.965,102.724l-83.397-68.276h-0.014C71.23,56.123,157.06,0,256,0C318.115,0,375.068,22.126,419.404,58.936z"></path></svg></span> <span>Google</span> </button> <button type="button" class="btn-social btn-facebook"> <span class="social-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="#1877F2"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></span> <span>Facebook</span> </button> </div> <div class="brand-highlight"> <div class="brand-assets"> <div class="brand-badge brand-logo"><img src="https://www.easy-markets.com/img/sponsorship/sponsorship-en.png" alt="Company logo" loading="lazy" /></div><div class="brand-badge brand-award"><img src="https://www.easy-markets.com/img/tradingview/Badge@2x.png" alt="TradingView award" loading="lazy" /></div><div class="brand-badge brand-trustpilot"> <script type="text/javascript" src="https://widget.trustpilot.com/bootstrap/v5/tp.widget.bootstrap.min.js" async></script> <div class="trustpilot-widget" data-locale="en-GB" data-template-id="5419b6ffb0d04a076446a9af" data-businessunit-id="57ad73410000ff0005936364" data-style-height="20px" data-style-width="100%" data-theme="light"> <a href="https://uk.trustpilot.com/review/easymarkets.com" target="_blank" rel="noopener">Trustpilot</a> </div></div> </div> </div> <div class="risk-warning"> <p><strong>Risk Warning:</strong> EU CFDs are complex instruments and come with a high risk of losing money rapidly due to leverage. Consider whether you understand how CFDs work and whether you can afford to take the high risk of losing your money.</p> </div> </form> <div class="restriction-modal hidden" data-role="canada-restriction-modal" aria-hidden="true"> <div class="modal-backdrop"></div> <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="canadaRestrictionHeading"> <div class="modal-content"> <div class="modal-heading" id="canadaRestrictionHeading">Restricted Region</div> <div class="modal-message"></div> <div class="modal-actions"> <button type="button" class="btn-modal-back">Back</button> <button type="button" class="btn btn-wide btn-link modal-cancel">or Exit the Registration Process</button> </div> </div> </div> </div> <script> (function() { const form = document.getElementById('registrationForm'); if (!form) return; const googleClientId = '982014466926-k3263vp9ekmmli69cg386kjskjdq49at.apps.googleusercontent.com' || window.GOOGLE_CLIENT_ID || ''; const facebookAppId = '828847466601485' || window.FACEBOOK_APP_ID || ''; const apiKey = 'key-eu-123' || window.API_KEY || ''; const IS_DEMO = false; const COUNTRY_METADATA = JSON.parse('{"AF":{"countryId":"249","callingCode":"93"},"AL":{"countryId":"1","callingCode":"355"},"DZ":{"countryId":"2","callingCode":"213"},"AD":{"countryId":"4","callingCode":"376"},"AO":{"countryId":"5","callingCode":"244"},"AI":{"countryId":"6","callingCode":"1"},"AQ":{"countryId":"7","callingCode":"672"},"AG":{"countryId":"8","callingCode":"1"},"AR":{"countryId":"9","callingCode":"54"},"AM":{"countryId":"10","callingCode":"374"},"AW":{"countryId":"11","callingCode":"297"},"AU":{"countryId":"12","callingCode":"61"},"AT":{"countryId":"13","callingCode":"43"},"AZ":{"countryId":"14","callingCode":"994"},"BS":{"countryId":"15","callingCode":"1"},"BH":{"countryId":"16","callingCode":"973"},"BD":{"countryId":"17","callingCode":"880"},"BB":{"countryId":"18","callingCode":"1"},"BY":{"countryId":"19","callingCode":"375"},"BE":{"countryId":"20","callingCode":"32"},"BZ":{"countryId":"21","callingCode":"501"},"BJ":{"countryId":"22","callingCode":"229"},"BM":{"countryId":"23","callingCode":"1"},"BT":{"countryId":"24","callingCode":"975"},"BO":{"countryId":"25","callingCode":"591"},"BA":{"countryId":"26","callingCode":"387"},"BW":{"countryId":"27","callingCode":"267"},"BR":{"countryId":"29","callingCode":"55"},"IO":{"countryId":"30","callingCode":"246"},"BN":{"countryId":"31","callingCode":"673"},"BG":{"countryId":"32","callingCode":"359"},"BF":{"countryId":"33","callingCode":"226"},"BI":{"countryId":"35","callingCode":"257"},"KH":{"countryId":"36","callingCode":"855"},"CM":{"countryId":"37","callingCode":"237"},"CA":{"countryId":"38","callingCode":"1"},"CV":{"countryId":"39","callingCode":"238"},"KY":{"countryId":"40","callingCode":"1"},"CF":{"countryId":"41","callingCode":"236"},"TD":{"countryId":"42","callingCode":"235"},"CL":{"countryId":"43","callingCode":"56"},"CN":{"countryId":"44","callingCode":"86"},"CX":{"countryId":"45","callingCode":"61"},"CC":{"countryId":"46","callingCode":"61"},"CO":{"countryId":"47","callingCode":"57"},"KM":{"countryId":"48","callingCode":"269"},"CG":{"countryId":"49","callingCode":"242"},"CD":{"countryId":"50","callingCode":"243"},"CK":{"countryId":"51","callingCode":"682"},"CR":{"countryId":"52","callingCode":"506"},"CI":{"countryId":"53","callingCode":"225"},"HR":{"countryId":"54","callingCode":"385"},"CU":{"countryId":"250","callingCode":"53"},"CY":{"countryId":"55","callingCode":"357"},"CZ":{"countryId":"56","callingCode":"420"},"DK":{"countryId":"57","callingCode":"45"},"DJ":{"countryId":"58","callingCode":"253"},"DM":{"countryId":"59","callingCode":"1"},"DO":{"countryId":"60","callingCode":"1"},"TL":{"countryId":"61","callingCode":"670"},"EC":{"countryId":"62","callingCode":"593"},"EG":{"countryId":"63","callingCode":"20"},"SV":{"countryId":"64","callingCode":"503"},"GQ":{"countryId":"66","callingCode":"240"},"ER":{"countryId":"67","callingCode":"291"},"EE":{"countryId":"69","callingCode":"372"},"ET":{"countryId":"70","callingCode":"251"},"FK":{"countryId":"71","callingCode":"500"},"FO":{"countryId":"72","callingCode":"298"},"FJ":{"countryId":"73","callingCode":"679"},"FI":{"countryId":"74","callingCode":"358"},"FR":{"countryId":"75","callingCode":"33"},"GF":{"countryId":"76","callingCode":"594"},"PF":{"countryId":"77","callingCode":"689"},"GA":{"countryId":"79","callingCode":"241"},"GM":{"countryId":"80","callingCode":"220"},"GE":{"countryId":"81","callingCode":"995"},"DE":{"countryId":"82","callingCode":"49"},"GH":{"countryId":"83","callingCode":"233"},"GI":{"countryId":"84","callingCode":"350"},"GR":{"countryId":"86","callingCode":"30"},"GL":{"countryId":"87","callingCode":"299"},"GD":{"countryId":"88","callingCode":"1"},"GP":{"countryId":"89","callingCode":"590"},"GT":{"countryId":"91","callingCode":"502"},"GG":{"countryId":"252","callingCode":"44"},"GN":{"countryId":"92","callingCode":"224"},"GW":{"countryId":"93","callingCode":"245"},"GY":{"countryId":"94","callingCode":"592"},"HT":{"countryId":"246","callingCode":"509"},"HN":{"countryId":"96","callingCode":"504"},"HK":{"countryId":"97","callingCode":"852"},"HU":{"countryId":"98","callingCode":"36"},"IS":{"countryId":"99","callingCode":"354"},"IN":{"countryId":"100","callingCode":"91"},"ID":{"countryId":"101","callingCode":"62"},"IR":{"countryId":"244","callingCode":"98"},"IQ":{"countryId":"248","callingCode":"964"},"IE":{"countryId":"102","callingCode":"353"},"IM":{"countryId":"254","callingCode":"44"},"IT":{"countryId":"104","callingCode":"39"},"JM":{"countryId":"105","callingCode":"1"},"JP":{"countryId":"106","callingCode":"81"},"JE":{"countryId":"255","callingCode":"44"},"JO":{"countryId":"107","callingCode":"962"},"KZ":{"countryId":"108","callingCode":"7"},"KE":{"countryId":"109","callingCode":"254"},"KI":{"countryId":"110","callingCode":"686"},"KW":{"countryId":"114","callingCode":"965"},"KG":{"countryId":"115","callingCode":"996"},"LA":{"countryId":"116","callingCode":"856"},"LV":{"countryId":"117","callingCode":"371"},"LB":{"countryId":"118","callingCode":"961"},"LS":{"countryId":"119","callingCode":"266"},"LR":{"countryId":"120","callingCode":"231"},"LY":{"countryId":"256","callingCode":"218"},"LI":{"countryId":"121","callingCode":"423"},"LT":{"countryId":"122","callingCode":"370"},"LU":{"countryId":"123","callingCode":"352"},"MO":{"countryId":"124","callingCode":"853"},"MG":{"countryId":"126","callingCode":"261"},"MW":{"countryId":"127","callingCode":"265"},"MY":{"countryId":"128","callingCode":"60"},"MV":{"countryId":"129","callingCode":"960"},"ML":{"countryId":"130","callingCode":"223"},"MT":{"countryId":"131","callingCode":"356"},"MH":{"countryId":"132","callingCode":"692"},"MQ":{"countryId":"133","callingCode":"596"},"MR":{"countryId":"134","callingCode":"222"},"MU":{"countryId":"135","callingCode":"230"},"YT":{"countryId":"136","callingCode":"262"},"MX":{"countryId":"137","callingCode":"52"},"FM":{"countryId":"138","callingCode":"691"},"MD":{"countryId":"139","callingCode":"373"},"MC":{"countryId":"140","callingCode":"377"},"MN":{"countryId":"141","callingCode":"976"},"ME":{"countryId":"262","callingCode":"382"},"MS":{"countryId":"142","callingCode":"1"},"MA":{"countryId":"143","callingCode":"212"},"MZ":{"countryId":"144","callingCode":"258"},"MM":{"countryId":"145","callingCode":"95"},"NA":{"countryId":"146","callingCode":"264"},"NR":{"countryId":"147","callingCode":"674"},"NP":{"countryId":"148","callingCode":"977"},"NL":{"countryId":"149","callingCode":"31"},"AN":{"countryId":"150","callingCode":"599"},"NC":{"countryId":"151","callingCode":"687"},"NZ":{"countryId":"152","callingCode":"64"},"NI":{"countryId":"153","callingCode":"505"},"NE":{"countryId":"154","callingCode":"227"},"NG":{"countryId":"155","callingCode":"234"},"NU":{"countryId":"156","callingCode":"683"},"NF":{"countryId":"157","callingCode":"672"},"MK":{"countryId":"125","callingCode":"389"},"MP":{"countryId":"159","callingCode":"1"},"NO":{"countryId":"160","callingCode":"47"},"OM":{"countryId":"161","callingCode":"968"},"PK":{"countryId":"162","callingCode":"92"},"PW":{"countryId":"163","callingCode":"680"},"PS":{"countryId":"242","callingCode":"970"},"PA":{"countryId":"164","callingCode":"507"},"PG":{"countryId":"165","callingCode":"675"},"PY":{"countryId":"166","callingCode":"595"},"PE":{"countryId":"167","callingCode":"51"},"PH":{"countryId":"168","callingCode":"63"},"PN":{"countryId":"169","callingCode":"64"},"PL":{"countryId":"170","callingCode":"48"},"PT":{"countryId":"171","callingCode":"351"},"QA":{"countryId":"173","callingCode":"974"},"RE":{"countryId":"174","callingCode":"262"},"RO":{"countryId":"175","callingCode":"40"},"RU":{"countryId":"177","callingCode":"7"},"RW":{"countryId":"178","callingCode":"250"},"SH":{"countryId":"257","callingCode":"290"},"KN":{"countryId":"179","callingCode":"1"},"LC":{"countryId":"180","callingCode":"1"},"MF":{"countryId":"265","callingCode":"590"},"PM":{"countryId":"201","callingCode":"508"},"VC":{"countryId":"181","callingCode":"1"},"WS":{"countryId":"182","callingCode":"685"},"SM":{"countryId":"183","callingCode":"378"},"ST":{"countryId":"184","callingCode":"239"},"SA":{"countryId":"185","callingCode":"966"},"SN":{"countryId":"187","callingCode":"221"},"RS":{"countryId":"243","callingCode":"381"},"SC":{"countryId":"188","callingCode":"248"},"SL":{"countryId":"189","callingCode":"232"},"SG":{"countryId":"190","callingCode":"65"},"SK":{"countryId":"191","callingCode":"421"},"SI":{"countryId":"192","callingCode":"386"},"SB":{"countryId":"193","callingCode":"677"},"SO":{"countryId":"194","callingCode":"252"},"ZA":{"countryId":"195","callingCode":"27"},"GS":{"countryId":"196","callingCode":"500"},"KR":{"countryId":"112","callingCode":"82"},"ES":{"countryId":"198","callingCode":"34"},"LK":{"countryId":"199","callingCode":"94"},"SD":{"countryId":"245","callingCode":"249"},"SR":{"countryId":"202","callingCode":"597"},"SJ":{"countryId":"203","callingCode":"47"},"SZ":{"countryId":"204","callingCode":"268"},"SE":{"countryId":"205","callingCode":"46"},"CH":{"countryId":"206","callingCode":"41"},"SY":{"countryId":"247","callingCode":"963"},"TW":{"countryId":"207","callingCode":"886"},"TJ":{"countryId":"208","callingCode":"992"},"TZ":{"countryId":"209","callingCode":"255"},"TH":{"countryId":"210","callingCode":"66"},"TG":{"countryId":"211","callingCode":"228"},"TK":{"countryId":"212","callingCode":"690"},"TO":{"countryId":"213","callingCode":"676"},"TT":{"countryId":"215","callingCode":"1"},"TN":{"countryId":"216","callingCode":"216"},"TR":{"countryId":"217","callingCode":"90"},"TM":{"countryId":"218","callingCode":"993"},"TC":{"countryId":"219","callingCode":"1"},"TV":{"countryId":"220","callingCode":"688"},"UG":{"countryId":"221","callingCode":"256"},"UA":{"countryId":"222","callingCode":"380"},"AE":{"countryId":"223","callingCode":"971"},"GB":{"countryId":"264","callingCode":"44"},"UY":{"countryId":"227","callingCode":"598"},"UZ":{"countryId":"229","callingCode":"998"},"VU":{"countryId":"230","callingCode":"678"},"VA":{"countryId":"231","callingCode":"39"},"VE":{"countryId":"232","callingCode":"58"},"VN":{"countryId":"233","callingCode":"84"},"VG":{"countryId":"234","callingCode":"1"},"WF":{"countryId":"237","callingCode":"681"},"EH":{"countryId":"238","callingCode":"212"},"YE":{"countryId":"239","callingCode":"967"},"ZM":{"countryId":"240","callingCode":"260"},"ZW":{"countryId":"241","callingCode":"263"}}'); const CANADA_METADATA = COUNTRY_METADATA['CA'] || {}; const CANADA_COUNTRY_ID = CANADA_METADATA.countryId || '38'; const CANADA_PROVINCE_RESTRICTION_TEMPLATE = 'Due to regulatory restrictions, we cannot onboard clients from {{province}}.'; const CANADA_PROVINCE_MODAL_HEADING = 'Restricted Region'; const CANADA_PROVINCE_MODAL_BODY = '<p>For regulatory and compliance purposes, unfortunately we cannot register clients from <strong>{{province}}</strong>.</p>'; const RESTRICTED_CANADIAN_PROVINCES = ['BC','MB','ON','QC']; const FIRST_NAME_ERROR = 'Only alphabetic characters are allowed in the first name'; const LAST_NAME_ERROR = 'Only alphabetic characters are allowed in the last name'; const PHONE_DIGITS_ERROR = 'Phone number can contain digits only'; const PASSWORD_MIN_ERROR = 'Password must be at least 6 characters'; const PASSWORD_MAX_ERROR = 'Password cannot exceed 20 characters'; const EMAIL_INVALID_ERROR = 'Please enter a valid email address'; const EMAIL_EXISTS_ERROR = 'This email is already registered'; const NAME_REGEX = /^[A-Za-z ]+$/; const PHONE_REGEX = /^[0-9]+$/; const EMAIL_REGEX = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; let provinceModal = null; let stateSelectRef = null; let countrySelectRef = null; let emailTaken = false; let emailCheckTimeoutId = null; const submitBtn = form.querySelector('.btn-submit'); prefillLocationFields(); setupCanadianProvinceHandling(); setupRealtimeValidation(); provinceModal = initProvinceRestrictionModal(); updateSubmitButtonState(); form.addEventListener('submit', function(e) { e.preventDefault(); const formData = new FormData(form); const data = Object.fromEntries(formData); data.isDemo = IS_DEMO; formData.set('isDemo', IS_DEMO ? 'true' : 'false'); if (!validateForm(data)) { return; } if (!submitBtn) { return; } const originalText = submitBtn.textContent; submitBtn.disabled = true; submitBtn.textContent = 'Processing...'; submitRegistration(data) .then(() => { /* success handled inside submitRegistration */ }) .catch((error) => { console.error('Registration failed', error); showError('An unexpected error occurred.'); }) .finally(() => { submitBtn.disabled = false; submitBtn.textContent = originalText; }); }); const googleBtn = form.querySelector('.btn-google'); const facebookBtn = form.querySelector('.btn-facebook'); if (googleBtn) { googleBtn.addEventListener('click', handleGoogleLogin); } if (facebookBtn) { facebookBtn.addEventListener('click', handleFacebookLogin); } function handleGoogleLogin() { const clientId = googleClientId || window.GOOGLE_CLIENT_ID || ''; if (!clientId) { showError('Google login is not configured'); return; } const googleBtn = form.querySelector('.btn-google'); if (googleBtn) { googleBtn.disabled = true; } /* Load Google Identity Services if not already loaded*/ if (typeof window.google === 'undefined' || !window.google.accounts) { const script = document.createElement('script'); script.src = 'https://accounts.google.com/gsi/client'; script.async = true; script.defer = true; script.onload = () => { initializeGoogleSignIn(clientId); }; script.onerror = () => { showError('Failed to load Google Sign-In library'); if (googleBtn) { googleBtn.disabled = false; } }; document.head.appendChild(script); } else { initializeGoogleSignIn(clientId); } } function initializeGoogleSignIn(clientId) { if (typeof window.google === 'undefined' || !window.google.accounts) { showError('Google Sign-In library failed to load'); const googleBtn = form.querySelector('.btn-google'); if (googleBtn) { googleBtn.disabled = false; } return; } /* Initialize Google Sign-In with ID token flow (more secure)*/ window.google.accounts.id.initialize({ client_id: clientId, callback: handleGoogleCredentialResponse, }); /* Use OAuth2 token client for access token flow*/ const tokenClient = window.google.accounts.oauth2.initTokenClient({ client_id: clientId, scope: 'https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile', callback: handleGoogleTokenResponse, }); /* Request access token (this will open the OAuth popup)*/ tokenClient.requestAccessToken({ prompt: 'consent' }); } function handleGoogleCredentialResponse(response) { if (response.credential) { /* This is an ID token, submit it directly*/ submitGoogleToken(response.credential); } else { showError('Google sign-in was cancelled'); const googleBtn = form.querySelector('.btn-google'); if (googleBtn) { googleBtn.disabled = false; } } } function handleGoogleTokenResponse(tokenResponse) { if (tokenResponse.access_token) { /* This is an access token, submit it*/ submitGoogleToken(tokenResponse.access_token); } else if (tokenResponse.error) { const errorMsg = tokenResponse.error === 'popup_closed_by_user' ? 'Sign-in was cancelled' : 'Google sign-in failed: ' + (tokenResponse.error_description || tokenResponse.error); showError(errorMsg); const googleBtn = form.querySelector('.btn-google'); if (googleBtn) { googleBtn.disabled = false; } } } async function submitGoogleToken(token) { const googleBtn = form.querySelector('.btn-google'); try { const currentApiKey = apiKey || window.API_KEY || ''; const origin = window.location.origin; const apiBaseUrl = window.API_BASE_URL || origin; const apiUrl = apiBaseUrl + '/api/social-login'; if (!currentApiKey) { showError('API key is not configured. Please set window.API_KEY.'); if (googleBtn) { googleBtn.disabled = false; } return; } const requestBody = JSON.stringify({ provider: 'google', token: token, region: 'eu', lang: 'en', }); const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json', 'x-api-key': currentApiKey, 'Origin': origin, }, body: requestBody, }); if (!response.ok) { let errorMsg = 'Registration failed'; try { const errorData = await response.json(); errorMsg = errorData.error?.message || errorData.message || 'HTTP ' + response.status + ': ' + response.statusText; } catch (e) { errorMsg = 'HTTP ' + response.status + ': ' + (response.statusText || 'Request failed'); } showError(errorMsg); if (response.status === 401 || response.status === 403) { form.dispatchEvent(new CustomEvent('registration:error', { bubbles: true, detail: { code: 'AUTH_ERROR', message: errorMsg }, })); } return; } const data = await response.json(); if (data.success) { showSuccess(data.message || 'Registration successful!'); form.dispatchEvent(new CustomEvent('registration:success', { bubbles: true, detail: data, })); } else if (data.requiresCompletion && data.prefillData) { /* Pre-fill form with social login data and let user complete*/ const prefillData = data.prefillData; const missingFields = data.error?.missingFields || []; /* Pre-fill available fields*/ Object.keys(prefillData).forEach(function(fieldName) { const field = form.querySelector('[name="' + fieldName + '"]'); if (field && (field.tagName === 'INPUT' || field.tagName === 'SELECT')) { const value = prefillData[fieldName]; if (value !== undefined && value !== null && value !== '') { if (field.tagName === 'SELECT') { field.value = String(value); field.dispatchEvent(new Event('change')); } else { field.value = String(value); field.dispatchEvent(new Event('input')); } } } }); /* Focus on first missing field*/ if (missingFields.length > 0) { const firstMissingField = form.querySelector('[name="' + missingFields[0] + '"]'); if (firstMissingField) { setTimeout(function() { firstMissingField.focus(); }, 100); } } /* Optionally handle missing fields without alerting */ const missingFieldsText = missingFields.join(', '); console.info('Missing fields to complete:', missingFieldsText); form.dispatchEvent(new CustomEvent('registration:prefill', { bubbles: true, detail: { prefillData, missingFields }, })); } else { const errorCode = data.error?.code || ''; const errorMsg = data.error?.message || 'Registration failed'; /* Handle specific error codes*/ if (errorCode === 'EMAIL_ALREADY_EXISTS') { showError('This email is already registered. Please use a different email or try logging in.'); form.dispatchEvent(new CustomEvent('registration:error', { bubbles: true, detail: { code: 'EMAIL_ALREADY_EXISTS', message: errorMsg }, })); } else { showError(errorMsg); if (errorCode) { form.dispatchEvent(new CustomEvent('registration:error', { bubbles: true, detail: { code: errorCode, message: errorMsg }, })); } } } } catch (error) { console.error('Google registration error:', error); showError('An error occurred during registration. Please try again.'); } finally { if (googleBtn) { googleBtn.disabled = false; } } } function handleFacebookLogin() { const appId = facebookAppId || window.FACEBOOK_APP_ID || ''; if (!appId) { showError('Facebook login is not configured'); return; } const facebookBtn = form.querySelector('.btn-facebook'); if (facebookBtn) { facebookBtn.disabled = true; } /* Load Facebook SDK if not already loaded*/ if (typeof window.FB === 'undefined') { const script = document.createElement('script'); script.src = 'https://connect.facebook.net/en_US/sdk.js'; script.async = true; script.defer = true; script.crossOrigin = 'anonymous'; script.onload = () => { initializeFacebookSDK(appId); }; script.onerror = () => { showError('Failed to load Facebook SDK'); if (facebookBtn) { facebookBtn.disabled = false; } }; document.head.appendChild(script); } else { initializeFacebookSDK(appId); } } function initializeFacebookSDK(appId) { if (typeof window.FB === 'undefined') { showError('Facebook SDK failed to load'); const facebookBtn = form.querySelector('.btn-facebook'); if (facebookBtn) { facebookBtn.disabled = false; } return; } /* Initialize Facebook SDK*/ window.FB.init({ appId: appId, cookie: true, xfbml: true, version: 'v18.0' }); /* Check login status first*/ window.FB.getLoginStatus(function(response) { if (response.status === 'connected') { /* User is already logged in, use existing token*/ submitFacebookToken(response.authResponse.accessToken); } else { /* User not logged in, trigger login*/ window.FB.login(function(loginResponse) { if (loginResponse.authResponse) { submitFacebookToken(loginResponse.authResponse.accessToken); } else { showError('Facebook login was cancelled or failed'); const facebookBtn = form.querySelector('.btn-facebook'); if (facebookBtn) { facebookBtn.disabled = false; } } }, { scope: 'email,public_profile', return_scopes: true }); } }); } async function submitFacebookToken(token) { const facebookBtn = form.querySelector('.btn-facebook'); try { const currentApiKey = apiKey || window.API_KEY || ''; const origin = window.location.origin; const apiBaseUrl = window.API_BASE_URL || origin; const apiUrl = apiBaseUrl + '/api/social-login'; if (!currentApiKey) { showError('API key is not configured. Please set window.API_KEY.'); if (facebookBtn) { facebookBtn.disabled = false; } return; } const requestBody = JSON.stringify({ provider: 'facebook', token: token, region: 'eu', lang: 'en', }); const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json', 'x-api-key': currentApiKey, 'Origin': origin, }, body: requestBody, }); if (!response.ok) { let errorMsg = 'Registration failed'; try { const errorData = await response.json(); errorMsg = errorData.error?.message || errorData.message || 'HTTP ' + response.status + ': ' + response.statusText; } catch (e) { errorMsg = 'HTTP ' + response.status + ': ' + (response.statusText || 'Request failed'); } showError(errorMsg); if (response.status === 401 || response.status === 403) { form.dispatchEvent(new CustomEvent('registration:error', { bubbles: true, detail: { code: 'AUTH_ERROR', message: errorMsg }, })); } return; } const data = await response.json(); if (data.success) { showSuccess(data.message || 'Registration successful!'); form.dispatchEvent(new CustomEvent('registration:success', { bubbles: true, detail: data, })); } else if (data.requiresCompletion && data.prefillData) { /* Pre-fill form with social login data and let user complete*/ const prefillData = data.prefillData; const missingFields = data.error?.missingFields || []; /* Pre-fill available fields*/ Object.keys(prefillData).forEach(function(fieldName) { const field = form.querySelector('[name="' + fieldName + '"]'); if (field && (field.tagName === 'INPUT' || field.tagName === 'SELECT')) { const value = prefillData[fieldName]; if (value !== undefined && value !== null && value !== '') { if (field.tagName === 'SELECT') { field.value = String(value); field.dispatchEvent(new Event('change')); } else { field.value = String(value); field.dispatchEvent(new Event('input')); } } } }); /* Focus on first missing field*/ if (missingFields.length > 0) { const firstMissingField = form.querySelector('[name="' + missingFields[0] + '"]'); if (firstMissingField) { setTimeout(function() { firstMissingField.focus(); }, 100); } } /* Optionally handle missing fields without alerting */ const missingFieldsText = missingFields.join(', '); console.info('Missing fields to complete:', missingFieldsText); form.dispatchEvent(new CustomEvent('registration:prefill', { bubbles: true, detail: { prefillData, missingFields }, })); } else { const errorCode = data.error?.code || ''; const errorMsg = data.error?.message || 'Registration failed'; /* Handle specific error codes*/ if (errorCode === 'EMAIL_ALREADY_EXISTS') { showError('This email is already registered. Please use a different email or try logging in.'); form.dispatchEvent(new CustomEvent('registration:error', { bubbles: true, detail: { code: 'EMAIL_ALREADY_EXISTS', message: errorMsg }, })); } else { showError(errorMsg); if (errorCode) { form.dispatchEvent(new CustomEvent('registration:error', { bubbles: true, detail: { code: errorCode, message: errorMsg }, })); } } } } catch (error) { console.error('Facebook registration error:', error); showError('An error occurred during registration. Please try again.'); } finally { if (facebookBtn) { facebookBtn.disabled = false; } } } function validateForm(data) { clearErrors(); let isValid = true; form.querySelectorAll('[required]').forEach(field => { if (!data[field.name] || data[field.name].toString().trim() === '') { showFieldError(field.name, 'This field is required'); isValid = false; } }); if (data.email) { if (!EMAIL_REGEX.test(data.email)) { showFieldError('email', 'Please enter a valid email address'); isValid = false; } else if (emailTaken) { showFieldError('email', EMAIL_EXISTS_ERROR); isValid = false; } } if (data.firstName && !NAME_REGEX.test(data.firstName.trim())) { showFieldError('firstName', FIRST_NAME_ERROR); isValid = false; } if (data.lastName && !NAME_REGEX.test(data.lastName.trim())) { showFieldError('lastName', LAST_NAME_ERROR); isValid = false; } if (data.password) { if (data.password.length < 6) { showFieldError('password', PASSWORD_MIN_ERROR); isValid = false; } else if (data.password.length > 20) { showFieldError('password', PASSWORD_MAX_ERROR); isValid = false; } } if (data.phone && !PHONE_REGEX.test(data.phone.trim())) { showFieldError('phone', PHONE_DIGITS_ERROR); isValid = false; } return isValid; } function updateSubmitButtonState() { if (!submitBtn) { return; } const formData = new FormData(form); const data = Object.fromEntries(formData); let isValid = true; form.querySelectorAll('[required]').forEach((field) => { const name = field.name; const value = (data[name] || '').toString().trim(); if (!value) { isValid = false; } }); if (data.email && !EMAIL_REGEX.test(data.email.toString().trim())) { isValid = false; } if (emailTaken) { isValid = false; } if (data.firstName && !NAME_REGEX.test(data.firstName.toString().trim())) { isValid = false; } if (data.lastName && !NAME_REGEX.test(data.lastName.toString().trim())) { isValid = false; } if (data.phone && !PHONE_REGEX.test(data.phone.toString().trim())) { isValid = false; } if (data.password) { const pwd = data.password.toString(); if (pwd.length < 6 || pwd.length > 20) { isValid = false; } } submitBtn.disabled = !isValid; } function showFieldError(fieldName, message) { const errorEl = form.querySelector(`.error-message[data-field="${fieldName}"]`); if (errorEl) { errorEl.textContent = message; const group = errorEl.closest('.form-group, .phone-group'); if (group) { group.classList.add('has-error'); } } } function clearErrors() { form.querySelectorAll('.error-message').forEach(el => { el.textContent = ''; const group = el.closest('.form-group, .phone-group'); if (group) { group.classList.remove('has-error'); } }); } function showSuccess(message) { alert(message); form.reset(); } function showError(message) { alert(message); } async function submitRegistration(data) { const currentApiKey = apiKey || window.API_KEY || ''; const origin = window.location.origin; const apiBaseUrl = window.API_BASE_URL || origin; const apiUrl = apiBaseUrl + '/api/register-user'; if (!currentApiKey) { showError('API key is not configured. Please set window.API_KEY.'); return; } try { const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json', 'x-api-key': currentApiKey, 'Origin': origin, }, body: JSON.stringify({ region: 'eu', lang: 'en', data, }), }); const json = await response.json(); if (!response.ok || !json.success) { const errorMsg = json?.error?.message || json?.message || 'Registration failed'; showError(errorMsg); /* surface validation details if present*/ if (json?.error?.details && Array.isArray(json.error.details)) { const firstDetail = json.error.details[0]; if (firstDetail?.field && firstDetail?.message) { showFieldError(firstDetail.field, firstDetail.message); } } if (json?.error?.code === 'EMAIL_ALREADY_EXISTS') { form.dispatchEvent(new CustomEvent('registration:error', { bubbles: true, detail: { code: 'EMAIL_ALREADY_EXISTS', message: errorMsg }, })); } return; } showSuccess(json.message || 'Registration successful!'); form.dispatchEvent(new CustomEvent('registration:success', { bubbles: true, detail: json, })); form.reset(); } catch (err) { console.error('Registration error:', err); showError('An error occurred during registration. Please try again.'); } } function prefillLocationFields() { const countrySelect = form.querySelector('select[name="country"]'); const countryCodeSelect = form.querySelector('select[name="countryCode"]'); if (!countrySelect && !countryCodeSelect) { return; } const preferredIso = getPreferredIso(); const preferredCountryId = (window.PREFERRED_COUNTRY_ID || '').toString(); const preferredCallingCode = normalizeCallingCode(window.PREFERRED_COUNTRY_CALLING_CODE); if (countrySelect && preferredCountryId && setSelectValue(countrySelect, preferredCountryId)) { /* done */ } else if (countrySelect && preferredIso) { trySetCountryByIso(countrySelect, preferredIso); } if (countryCodeSelect && preferredCallingCode && setSelectValue(countryCodeSelect, preferredCallingCode)) { /* done */ } else if (countryCodeSelect && preferredIso) { trySetCallingCodeByIso(countryCodeSelect, preferredIso); } if ((countrySelect && countrySelect.value) && (countryCodeSelect && countryCodeSelect.value)) { return; } fetchIpwhoCountry() .then((result) => { if (!result) { return; } const iso = normalizeIso(result.iso); if (countrySelect && !countrySelect.value && iso) { trySetCountryByIso(countrySelect, iso); } const callingCode = result.callingCode || (iso ? getCallingCodeFromMetadata(iso) : undefined); if (countryCodeSelect && !countryCodeSelect.value && callingCode) { setSelectValue(countryCodeSelect, callingCode); } }) .catch((error) => { console.warn('Country prefill failed', error); }); } function setupCanadianProvinceHandling() { const countrySelect = form.querySelector('select[name="country"]'); const stateGroup = form.querySelector('.state-field'); const stateSelect = form.querySelector('select[name="state"]'); if (!countrySelect || !stateGroup || !stateSelect) { return; } countrySelectRef = countrySelect; stateSelectRef = stateSelect; const restrictedSet = new Set(RESTRICTED_CANADIAN_PROVINCES); const toggleVisibility = () => { const shouldShow = countrySelect.value === CANADA_COUNTRY_ID; stateGroup.classList.toggle('hidden', !shouldShow); stateSelect.required = shouldShow; if (!shouldShow) { stateSelect.value = ''; } }; const maybeWarnRestriction = () => { if (!stateSelect.value || !restrictedSet.has(stateSelect.value)) { return; } const provinceName = getSelectedOptionLabel(stateSelect); showProvinceRestriction(provinceName); }; countrySelect.addEventListener('change', () => { toggleVisibility(); if (countrySelect.value === CANADA_COUNTRY_ID) { maybeWarnRestriction(); } }); stateSelect.addEventListener('change', maybeWarnRestriction); toggleVisibility(); } function setupRealtimeValidation() { const firstNameInput = form.querySelector('input[name="firstName"]'); const lastNameInput = form.querySelector('input[name="lastName"]'); const phoneInput = form.querySelector('input[name="phone"]'); const emailInput = form.querySelector('input[name="email"]'); const passwordInput = form.querySelector('input[name="password"]'); if (firstNameInput) { firstNameInput.addEventListener('input', () => { handleNameInput(firstNameInput, 'firstName', FIRST_NAME_ERROR); updateSubmitButtonState(); }); } if (lastNameInput) { lastNameInput.addEventListener('input', () => { handleNameInput(lastNameInput, 'lastName', LAST_NAME_ERROR); updateSubmitButtonState(); }); } if (phoneInput) { phoneInput.addEventListener('input', () => { handlePhoneInput(phoneInput); updateSubmitButtonState(); }); phoneInput.addEventListener('beforeinput', (event) => { if (event.data && /[^0-9]/.test(event.data)) { event.preventDefault(); } }); } if (emailInput) { emailInput.addEventListener('input', () => { handleEmailInput(emailInput); updateSubmitButtonState(); }); } if (passwordInput) { passwordInput.addEventListener('input', () => { handlePasswordInput(passwordInput); updateSubmitButtonState(); }); } form.addEventListener('change', updateSubmitButtonState); } function handleNameInput(input, fieldName, errorMessage) { const value = input.value.trim(); if (!value || NAME_REGEX.test(value)) { const errorEl = form.querySelector(`.error-message[data-field="${fieldName}"]`); if (errorEl) { errorEl.textContent = ''; const group = errorEl.closest('.form-group, .phone-group'); if (group) { group.classList.remove('has-error'); } } } else { showFieldError(fieldName, errorMessage); } } function handlePhoneInput(input) { const value = input.value.trim(); if (!value || PHONE_REGEX.test(value)) { const errorEl = form.querySelector(`.error-message[data-field="phone"]`); if (errorEl) { errorEl.textContent = ''; const group = errorEl.closest('.form-group, .phone-group'); if (group) { group.classList.remove('has-error'); } } } else { showFieldError('phone', PHONE_DIGITS_ERROR); } } function handleEmailInput(input) { const value = input.value.trim(); if (!value || !EMAIL_REGEX.test(value)) { emailTaken = false; const errorEl = form.querySelector('.error-message[data-field="email"]'); if (errorEl) { if (!value) { errorEl.textContent = ''; const group = errorEl.closest('.form-group, .phone-group'); if (group) { group.classList.remove('has-error'); } } else { showFieldError('email', EMAIL_INVALID_ERROR); } } else if (!value) { /*no error element and no value, nothing else to do*/ } return; } /* Valid email format. Clear any previous format error and check existence.*/ const errorEl = form.querySelector('.error-message[data-field="email"]'); if (errorEl && !emailTaken) { errorEl.textContent = ''; const group = errorEl.closest('.form-group, .phone-group'); if (group) { group.classList.remove('has-error'); } } if (emailCheckTimeoutId) { clearTimeout(emailCheckTimeoutId); } emailCheckTimeoutId = setTimeout(() => { checkEmailAvailability(value); }, 500); } function handlePasswordInput(input) { const value = input.value || ''; let error = ''; if (value && value.length < 6) { error = PASSWORD_MIN_ERROR; } else if (value && value.length > 20) { error = PASSWORD_MAX_ERROR; } const errorEl = form.querySelector('.error-message[data-field="password"]'); if (!errorEl) { return; } if (!error) { errorEl.textContent = ''; const group = errorEl.closest('.form-group, .phone-group'); if (group) { group.classList.remove('has-error'); } } else { showFieldError('password', error); } } async function checkEmailAvailability(email) { emailTaken = false; try { const currentApiKey = apiKey || window.API_KEY || ''; const origin = window.location.origin; const apiBaseUrl = window.API_BASE_URL || origin; const apiUrl = apiBaseUrl + '/api/check-email'; if (!currentApiKey) { /* Skip email check if API key is not configured*/ updateSubmitButtonState(); return; } const response = await fetch(apiUrl, { method: 'POST', headers: { 'x-api-key': currentApiKey, 'Content-Type': 'application/json', 'Origin': origin, }, body: JSON.stringify({ email }), }); if (!response.ok) { console.warn('Email availability check failed with status', response.status); updateSubmitButtonState(); return; } let data; try { data = await response.json(); } catch (err) { console.warn('Email availability response was not JSON', err); updateSubmitButtonState(); return; } const exists = Boolean(data && data.data && data.data.exists); const currentEmailInput = form.querySelector('input[name="email"]'); const currentValue = currentEmailInput ? currentEmailInput.value.trim() : ''; /* Only apply the result if the email hasn't changed since we fired the request*/ if (currentValue !== email) { updateSubmitButtonState(); return; } emailTaken = exists; const errorEl = form.querySelector('.error-message[data-field="email"]'); if (exists) { showFieldError('email', EMAIL_EXISTS_ERROR); } else if (errorEl) { errorEl.textContent = ''; const group = errorEl.closest('.form-group, .phone-group'); if (group) { group.classList.remove('has-error'); } } } catch (error) { console.warn('Email availability check failed', error); } finally { updateSubmitButtonState(); } } function initProvinceRestrictionModal() { const modal = form.parentElement ? form.parentElement.querySelector('[data-role="canada-restriction-modal"]') : document.querySelector('[data-role="canada-restriction-modal"]'); if (!modal) { return null; } const backButton = modal.querySelector('.btn-modal-back'); if (backButton) { backButton.addEventListener('click', handleProvinceBack); } const cancelButton = modal.querySelector('.modal-cancel'); if (cancelButton) { cancelButton.addEventListener('click', handleRegistrationExit); } return modal; } function getSelectedOptionLabel(select) { const option = select.options[select.selectedIndex]; return option ? option.textContent || option.value : select.value; } function showProvinceRestriction(provinceName) { if (provinceModal) { const headingEl = provinceModal.querySelector('.modal-heading'); const messageEl = provinceModal.querySelector('.modal-message'); if (headingEl) { headingEl.textContent = applyProvinceTemplate( CANADA_PROVINCE_MODAL_HEADING, provinceName ); } if (messageEl) { messageEl.innerHTML = applyProvinceTemplate( CANADA_PROVINCE_MODAL_BODY, provinceName ); } provinceModal.classList.remove('hidden'); provinceModal.setAttribute('aria-hidden', 'false'); document.body.classList.add('modal-open'); const focusTarget = provinceModal.querySelector('.btn-modal-back'); if (focusTarget) { focusTarget.focus(); } return; } const template = CANADA_PROVINCE_RESTRICTION_TEMPLATE; if (!template) { alert('Selected province is restricted.'); return; } const message = template.includes('{{province}}') ? template.replace(/{{province}}/g, provinceName) : template; alert(message); } function hideProvinceRestrictionModal(modal) { if (!modal) { return; } modal.classList.add('hidden'); modal.setAttribute('aria-hidden', 'true'); document.body.classList.remove('modal-open'); } function applyProvinceTemplate(template, provinceName) { if (!template) { return provinceName; } return template.includes('{{province}}') ? template.replace(/{{province}}/g, provinceName) : template; } function handleProvinceBack() { if (stateSelectRef) { stateSelectRef.value = ''; stateSelectRef.dispatchEvent(new Event('change')); } hideProvinceRestrictionModal(provinceModal); } function handleRegistrationExit() { hideProvinceRestrictionModal(provinceModal); if (form) { form.reset(); form.dispatchEvent( new CustomEvent('registration:exit', { bubbles: true, detail: { reason: 'canada_province_restriction' }, }) ); } } function setSelectValue(select, value) { const normalized = value.replace(/^\+/, '').trim(); if (!normalized) return false; const option = Array.from(select.options).find( (opt) => opt.value === normalized ); if (option) { select.value = normalized; select.dispatchEvent(new Event('change')); return true; } return false; } function trySetCountryByIso(select, iso) { const metadata = COUNTRY_METADATA[iso]; if (!metadata || !metadata.countryId) { return false; } return setSelectValue(select, metadata.countryId); } function trySetCallingCodeByIso(select, iso) { const metadata = COUNTRY_METADATA[iso]; if (!metadata || !metadata.callingCode) { return false; } return setSelectValue(select, metadata.callingCode); } function getCallingCodeFromMetadata(iso) { const metadata = COUNTRY_METADATA[iso]; return metadata ? metadata.callingCode : undefined; } function getPreferredIso() { return normalizeIso(window.PREFERRED_COUNTRY_ISO || window.PREFERRED_COUNTRY); } function normalizeIso(value) { if (!value || typeof value !== 'string') { return undefined; } const trimmed = value.trim(); if (trimmed.length !== 2) { return undefined; } const upper = trimmed.toUpperCase(); return COUNTRY_METADATA[upper] ? upper : undefined; } function normalizeCallingCode(value) { if (value === undefined || value === null) { return undefined; } return value.toString().replace(/^\+/, '').trim() || undefined; } async function fetchIpwhoCountry() { try { const controller = new AbortController(); const timeoutId = setTimeout(() => controller.abort(), 2500); const response = await fetch('/api/geo', { signal: controller.signal, }); clearTimeout(timeoutId); if (!response.ok) { return undefined; } const data = await response.json(); const iso = normalizeIso(data?.country); if (!iso) { return undefined; } return { iso, callingCode: getCallingCodeFromMetadata(iso), }; } catch (error) { return undefined; } } })(); </script>
</body>
</html>